<!DOCTYPE html>
<html>
	<head>
	<title>Password Recovery</title>
	<meta charset = "utf-8">
	</head>
	<body>
	<form action = >
		Email:<br>
		<input type = "email" name = "email"><br>
		<input type = "submit" name = "Submit"><br><br>
	</form>
	<?php
		$dbname = "DATABASE"
		$conn = mysqli_connect("54.79.17.142","root","root",$dbname);
		if(!$conn -> connect_error) {
			die("Connection failed:" . $conn -> connect_error);
		}
		$email = $_POST['email'];
		$sql = "SELECT secretquestion, secretanswer FROM user WHERE email = " $email;
		$result = $conn -> query($sql);
		
		$json = json_encode($result);
		
		if($result -> num_rows > 0) {
			echo "<form action = change_password.php onsubmit = check_answer()>Secret question<br>"
			$row = $result -> fetch_assoc();
			echo $row["secretquestion"];
			echo "Secret Answer<br><input type = 'password' name = 'answer'><br>";
			echo "<input type = 'submit' name = 'submit'>"
		}
		$conn -> close();
	?>
	<script type = "text/javascript">
	function check_answer(form) {
		var answer = form.elements['answer'];
		var trueAnswer = <?php $json ?>;
		if(answer.value == "") {
			alert("Please enter an answer");
			answer.focus();
			return false;
		}
		if(answer.value != trueAnswer) {
			alert("Answer is not correct.");
			answer.focus();
			return false;
		}
		return true;
	}	
	</script>	
	</body>
</html>